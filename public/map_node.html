<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>data</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
      #map {
        height: 100vh; /* ทำให้แผนที่เต็มหน้าจอ */
        width: 100%; /* ความกว้างของแผนที่ */
      }
    </style>
</head>
<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
    const map = L.map('map').setView([16.508, 100.168], 10); // ตั้งค่าแผนที่

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
    }).addTo(map);

    // ฟังก์ชันสำหรับโหลดข้อมูลเมื่อเปิดหน้าเว็บ
    async function loadData() {
        const layers = ['tambon_banna', 'road_banna']; // เลเยอร์ที่ต้องการใช้ใน GeoServer
        
        for (const layerName of layers) {
            // ดึงข้อมูลจาก GeoServer
            const response = await fetch(`/api/geoserver?layerName=${layerName}`);
            
            if (response.ok) {
                const data = await response.json();
                console.log(`GeoServer data for ${layerName} fetched successfully:`, data); // ข้อความยืนยันว่าดึงข้อมูลสำเร็จ
                
                // แสดงข้อมูลบนแผนที่
                L.geoJSON(data, {
                    onEachFeature: function(feature, layer) {
                        layer.bindPopup(feature.properties.name || 'ไม่มีชื่อ'); // แสดงชื่อ (หรือข้อความอื่นๆ) เมื่อคลิกที่เลเยอร์
                    }
                });
            } else {
                console.error(`Error fetching GeoServer data for ${layerName}:`, response.statusText);
            }
        }

        // ดึงข้อมูลจาก API พยากรณ์อากาศ
        const forecastResponse = await fetch('/api/forecast');
        if (forecastResponse.ok) {
            const forecastData = await forecastResponse.json();
            console.log('Forecast data fetched successfully:', forecastData); // ข้อความยืนยันว่าดึงข้อมูลพยากรณ์อากาศสำเร็จ
        } else {
            console.error('Error fetching forecast data:', forecastResponse.statusText);
        }
    }

    // เรียกใช้งานฟังก์ชันโหลดข้อมูลเมื่อหน้าเว็บโหลดเสร็จ
    window.onload = loadData;
</script>

</body>
</html>
